"use strict";var __awaiter=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))(function(r,c){function E(e){try{A(t.next(e))}catch(e){c(e)}}function _(e){try{A(t.throw(e))}catch(e){c(e)}}function A(e){e.done?r(e.value):new i(function(n){n(e.value)}).then(E,_)}A((t=t.apply(e,n||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const BasicDriver_1=require("../base/BasicDriver");class MssqlDriver extends BasicDriver_1.default{constructor(e){super(),this.conn=e}getConnect(){return this.conn}getAllTablesQuery(){return __awaiter(this,void 0,void 0,function*(){const e=yield this.conn.query("SELECT TABLE_SCHEMA,TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE='BASE TABLE' order by TABLE_NAME"),n=[];return e.map(e=>{n.push({tableName:e.TABLE_NAME,tableScheme:e.TABLE_SCHEMA})}),n})}getColumnsFromTable(e){return __awaiter(this,void 0,void 0,function*(){const n=`SELECT TABLE_NAME,COLUMN_NAME,COLUMN_DEFAULT,IS_NULLABLE,\n                    DATA_TYPE, (case when CHARACTER_MAXIMUM_LENGTH in ( -1, 1000) then 2000 else CHARACTER_MAXIMUM_LENGTH end) as CHARACTER_MAXIMUM_LENGTH,NUMERIC_PRECISION,NUMERIC_SCALE,\n                    COLUMNPROPERTY(object_id(TABLE_NAME), COLUMN_NAME, 'IsIdentity') IsIdentity,\n                    (SELECT count(*) FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS tc\n                        inner join INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE cu on cu.CONSTRAINT_NAME = tc.CONSTRAINT_NAME\n                        where tc.CONSTRAINT_TYPE = 'UNIQUE' and tc.TABLE_NAME = c.TABLE_NAME and cu.COLUMN_NAME = c.COLUMN_NAME and tc.TABLE_SCHEMA=c.TABLE_SCHEMA) IsUnique\n                    FROM INFORMATION_SCHEMA.COLUMNS c where TABLE_NAME = '${e}'`;return yield this.conn.query(n)})}getPrimaryKey(e){return __awaiter(this,void 0,void 0,function*(){const n=`select col.name as PrimaryKey FROM sys.indexes ind\n                INNER JOIN  sys.index_columns ic ON  ind.object_id = ic.object_id and ind.index_id = ic.index_id\n                INNER JOIN  sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id\n                where ind.object_id=OBJECT_ID('${e}') and ind.is_primary_key = 1`;return yield this.conn.query(n)})}queryBySql(e){return __awaiter(this,void 0,void 0,function*(){return yield this.conn.query(e)})}}exports.MssqlDriver=MssqlDriver;